# Smithery configuration file for 1Password MCP Server
# Documentation: https://smithery.ai/docs/build/project-config

name: "@onepassword/mcp-server"
version: "1.1.0"
description: "Secure 1Password credential retrieval for AI assistants via MCP protocol with enterprise-grade security, resilience patterns, and monitoring"
author:
  name: "1Password MCP Server Contributors"
  url: "https://github.com/jon-the-dev/1password-mcp-server"
license: "MIT"
keywords:
  - 1password
  - credentials
  - security
  - authentication
  - mcp-server
  - password-manager

# Build configuration for Docker container
build:
  dockerfile: "Dockerfile"
  dockerBuildPath: "."

# Start command configuration for Streamable HTTP transport
startCommand:
  type: http
  configSchema:
    type: object
    properties:
      OP_SERVICE_ACCOUNT_TOKEN:
        type: string
        title: "1Password Service Account Token"
        description: "Optional manual override. When deployed via Smithery, the service account token is retrieved through the OAuth flow."
        pattern: "^ops_[a-zA-Z0-9_-]+"
        minLength: 8
      SECURITY_DEFAULT_VAULT:
        type: string
        title: "Default Vault"
        description: "Default 1Password vault name to retrieve credentials from"
        default: "AI"
      LOG_LEVEL:
        type: string
        title: "Log Level"
        description: "Logging verbosity level"
        enum: ["DEBUG", "INFO", "WARNING", "ERROR"]
        default: "INFO"
      ENVIRONMENT:
        type: string
        title: "Environment"
        description: "Deployment environment type"
        enum: ["development", "staging", "production"]
        default: "production"
      DESTRUCTIVE_ACTIONS:
        type: string
        title: "Enable Destructive Actions"
        description: "Enable create/update/delete credential operations (use with caution)"
        enum: ["true", "false"]
        default: "false"
    commandFunction: |-
      (config) => ({
        command: "uv",
        args: ["run", "python", "-m", "onepassword_mcp_server.server", "--transport", "streamable-http"],
        env: {
          NODE_ENV: "production",
          PORT: "8081",
          // Prefer the Smithery OAuth access token, fall back to user-provided config
          OP_SERVICE_ACCOUNT_TOKEN: (config.auth && config.auth.accessToken) || config.OP_SERVICE_ACCOUNT_TOKEN || "",
          SECURITY_DEFAULT_VAULT: config.SECURITY_DEFAULT_VAULT || "AI",
          LOG_LEVEL: config.LOG_LEVEL || "INFO",
          ENVIRONMENT: config.ENVIRONMENT || "production",
          DESTRUCTIVE_ACTIONS: config.DESTRUCTIVE_ACTIONS || "false"
        }
      })

# Example configuration for Smithery UI display
exampleConfig:
  OP_SERVICE_ACCOUNT_TOKEN: "ops_your_service_account_token_here"
  SECURITY_DEFAULT_VAULT: "AI"
  LOG_LEVEL: "INFO"
  ENVIRONMENT: "production"
  DESTRUCTIVE_ACTIONS: "false"
